var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,r){return new(i||(i=Promise))(function(n,s){function h(t){try{a(r.next(t))}catch(e){s(e)}}function o(t){try{a(r["throw"](t))}catch(e){s(e)}}function a(t){t.done?n(t.value):new i(function(e){e(t.value)}).then(h,o)}a((r=r.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return r([t,e])}}function r(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,s&&(h=s[2&i[0]?"return":i[0]?"throw":"next"])&&!(h=h.call(s,i[1])).done)return h;switch(s=0,h&&(i=[0,h.value]),i[0]){case 0:case 1:h=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,s=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(h=a.trys,!(h=h.length>0&&h[h.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!h||i[1]>h[0]&&i[1]<h[3])){a.label=i[1];break}if(6===i[0]&&a.label<h[1]){a.label=h[1],h=i;break}if(h&&a.label<h[2]){a.label=h[2],a.ops.push(i);break}h[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(r){i=[6,r],s=0}finally{n=h=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var n,s,h,o,a={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return o={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o},LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.loadGroup("preload")},e.prototype.onResourceLoadComplete=function(t){if("preload"==t.groupName){RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this);var e=new fighter.GameContainer;this.addChild(e)}},e.prototype.createGameScene=function(){},e}(egret.Sprite);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var fighter;!function(t){var e=function(e){function i(t,i,r){var n=e.call(this)||this;return n.blood=10,n.fireDelay=i,n.bmp=new egret.Bitmap(t),n.textureName=r,n.addChild(n.bmp),n.fireTimer=new egret.Timer(i),n.fireTimer.addEventListener(egret.TimerEvent.TIMER,n.createBullet,n),n}return __extends(i,e),i.prototype.fire=function(){this.fireTimer.start()},i.prototype.stopFire=function(){this.fireTimer.stop()},i.prototype.createBullet=function(t){this.dispatchEventWith("createBullet")},i.produce=function(e,i){null==t.Airplane.cacheDict[e]&&(t.Airplane.cacheDict[e]=[]);var r,n=t.Airplane.cacheDict[e];return r=n.length>0?n.pop():new t.Airplane(RES.getRes(e),i,e),r.blood=10,r},i.reclaim=function(e){var i=e.textureName;null==t.Airplane.cacheDict[i]&&(t.Airplane.cacheDict[i]=[]);var r=t.Airplane.cacheDict[i];-1==r.indexOf(e)&&r.push(e)},i.cacheDict={},i}(egret.DisplayObjectContainer);t.Airplane=e,__reflect(e.prototype,"fighter.Airplane")}(fighter||(fighter={}));var fighter;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.speed=2,t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(i,e),i.prototype.onAddToStage=function(e){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.stageW=this.stage.stageWidth,this.stageH=this.stage.stageHeight;var i=RES.getRes("nier_jpg");this.textureHeight=i.textureHeight,this.rowCount=Math.ceil(this.stageH/this.textureHeight)+1,this.bmpArr=[];for(var r=0;r<this.rowCount;r++){var n=t.createBitmapByName("bg_jpg");n.y=this.textureHeight*r-(this.textureHeight*this.rowCount-this.stageH),this.bmpArr.push(n),this.addChild(n)}},i.prototype.start=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandler,this),this.addEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandler,this)},i.prototype.enterFrameHandler=function(t){for(var e=0;e<this.rowCount;e++){var i=this.bmpArr[e];i.y+=this.speed,i.y>this.stageH&&(i.y=this.bmpArr[0].y-this.textureHeight,this.bmpArr.pop(),this.bmpArr.unshift(i))}},i.prototype.pause=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandler,this)},i}(egret.DisplayObjectContainer);t.BgMap=e,__reflect(e.prototype,"fighter.BgMap")}(fighter||(fighter={}));var fighter;!function(t){var e=function(e){function i(t){return e.call(this,t)||this}return __extends(i,e),i.produce=function(e){null==t.Bullet.cacheDict[e]&&(t.Bullet.cacheDict[e]=[]);var i,r=t.Bullet.cacheDict[e];return i=r.length>0?r.pop():new t.Bullet(RES.getRes(e)),i.textureName=e,i},i.reclaim=function(e){var i=e.textureName;null==t.Bullet.cacheDict[i]&&(t.Bullet.cacheDict[i]=[]);var r=t.Bullet.cacheDict[i];-1==r.indexOf(e)&&r.push(e)},i.cacheDict={},i}(egret.Bitmap);t.Bullet=e,__reflect(e.prototype,"fighter.Bullet")}(fighter||(fighter={}));var fighter;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.myBullets=[],t.enemyFighters=[],t.enemyFightersTimer=new egret.Timer(1e3),t.enemyBullets=[],t.myScore=0,t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(i,e),i.prototype.onAddToStage=function(t){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.createGameScene()},i.prototype.createGameScene=function(){this.stageW=this.stage.stageWidth,this.stageH=this.stage.stageHeight,this.bg=new t.BgMap,this.addChild(this.bg),this.btnStart=t.createBitmapByName("bullet2_png"),this.btnStart.x=(this.stageW-this.btnStart.width)/2,this.btnStart.y=(this.stageH-this.btnStart.height)/2,this.btnStart.touchEnabled=!0,this.btnStart.addEventListener(egret.TouchEvent.TOUCH_TAP,this.gameStart,this),this.addChild(this.btnStart),this.myFighter=new t.Airplane(RES.getRes("plane_png"),300,"plane_png"),this.myFighter.y=this.stageH-this.myFighter.height-50,this.myFighter.addEventListener("createBullet",this.createBulletHandler,this),this.addChild(this.myFighter),this.scorePanel=new t.ScorePanel},i.prototype.gameStart=function(){this.removeChild(this.btnStart),this.bg.start(),this.myFighter.fire(),this.enemyFightersTimer.addEventListener(egret.TimerEvent.TIMER,this.createEnemyFighter,this),this.enemyFightersTimer.start(),this.addEventListener(egret.Event.ENTER_FRAME,this.gameViewUpdate,this),this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchHandler,this)},i.prototype.createEnemyFighter=function(e){var i=t.Airplane.produce("plane2_png",1e3);i.x=Math.random()*(this.stageW-i.width),i.y=-i.height-300*Math.random(),i.addEventListener("createBullet",this.createBulletHandler,this),i.fire(),this.addChildAt(i,this.numChildren-1),this.enemyFighters.push(i)},i.prototype.createBulletHandler=function(e){var i;if(e.target==this.myFighter)for(var r=0;2>r;r++)i=t.Bullet.produce("bullet_png"),i.x=0==r?this.myFighter.x+10:this.myFighter.x+this.myFighter.width-22,i.y=this.myFighter.y+30,this.addChildAt(i,this.numChildren-1-this.enemyFighters.length),this.myBullets.push(i);else{var n=e.target;i=t.Bullet.produce("bullet2_png"),i.x=n.x+28,i.y=n.y+10,this.addChildAt(i,this.numChildren-1-this.enemyFighters.length),this.enemyBullets.push(i)}},i.prototype.gameViewUpdate=function(e){var i=egret.getTimer(),r=1e3/(i-this._lastTime);this._lastTime=i;for(var n,s=60/r,h=0,o=this.myBullets.length;o>h;h++)n=this.myBullets[h],n.y<-n.height&&(this.removeChild(n),t.Bullet.reclaim(n),this.myBullets.splice(h,1),h--,o--),n.y-=12*s;var a,l=this.enemyFighters.length;for(h=0;l>h;h++)a=this.enemyFighters[h],a.y>this.stage.stageHeight&&(this.removeChild(a),t.Airplane.reclaim(a),a.removeEventListener("createBullet",this.createBulletHandler,this),a.stopFire(),this.enemyFighters.splice(h,1),h--,l--),a.y+=4*s;var c=this.enemyBullets.length;for(h=0;c>h;h++)n=this.enemyBullets[h],n.y>this.stage.stageHeight&&(this.removeChild(n),t.Bullet.reclaim(n),this.enemyBullets.splice(h,1),h--,c--),n.y+=8*s;this.gameHitTest()},i.prototype.touchHandler=function(t){if(t.type==egret.TouchEvent.TOUCH_MOVE){var e=t.localX;e=Math.max(0,e),e=Math.min(this.stageW-this.myFighter.width,e),this.myFighter.x=e}},i.prototype.gameHitTest=function(){var e,i,r,n,s=this.myBullets.length,h=this.enemyFighters.length,o=this.enemyBullets.length,a=[],l=[];for(e=0;s>e;++e)for(r=this.myBullets[e],i=0;h>i;++i)n=this.enemyFighters[i],t.GameUtil.hitTest(n,r)&&(n.blood-=2,-1==a.indexOf(r)&&a.push(r),n.blood<=0&&-1==l.indexOf(n)&&l.push(n));for(e=0;o>e;++e)r=this.enemyBullets[e],t.GameUtil.hitTest(this.myFighter,r)&&(this.myFighter.blood-=1,-1==a.indexOf(r)&&a.push(r));for(e=0;h>e;++e)n=this.enemyFighters[e],t.GameUtil.hitTest(this.myFighter,n)&&(this.myFighter.blood-=10);if(this.myFighter.blood<=0)this.gameStop();else{for(;a.length>0;)r=a.pop(),this.removeChild(r),"bullet_png"==r.textureName?this.myBullets.splice(this.myBullets.indexOf(r),1):this.enemyBullets.splice(this.enemyBullets.indexOf(r),1),t.Bullet.reclaim(r);for(this.myScore+=l.length;l.length>0;)n=l.pop(),n.stopFire(),n.removeEventListener("createBullet",this.createBulletHandler,this),this.removeChild(n),this.enemyFighters.splice(this.enemyFighters.indexOf(n),1),t.Airplane.reclaim(n)}},i.prototype.gameStop=function(){this.addChild(this.btnStart),this.bg.pause(),this.removeEventListener(egret.Event.ENTER_FRAME,this.gameViewUpdate,this),this.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchHandler,this),this.myFighter.stopFire(),this.myFighter.removeEventListener("createBullet",this.createBulletHandler,this),this.enemyFightersTimer.removeEventListener(egret.TimerEvent.TIMER,this.createEnemyFighter,this),this.enemyFightersTimer.stop();for(var e;this.myBullets.length>0;)e=this.myBullets.pop(),this.removeChild(e),t.Bullet.reclaim(e);for(;this.enemyBullets.length>0;)e=this.enemyBullets.pop(),this.removeChild(e),t.Bullet.reclaim(e);for(var i;this.enemyFighters.length>0;)i=this.enemyFighters.pop(),i.stopFire(),i.removeEventListener("createBullet",this.createBulletHandler,this),this.removeChild(i),t.Airplane.reclaim(i);this.scorePanel.showScore(this.myScore),this.scorePanel.x=(this.stageW-this.scorePanel.width)/2,this.scorePanel.y=100,this.addChild(this.scorePanel)},i}(egret.DisplayObjectContainer);t.GameContainer=e,__reflect(e.prototype,"fighter.GameContainer")}(fighter||(fighter={}));var fighter;!function(t){var e=function(t){function e(){var e=t.call(this)||this,i=e.graphics;return i.beginFill(0,.8),i.drawRect(0,0,400,200),i.endFill(),e.txt=new egret.TextField,e.txt.width=400,e.txt.height=200,e.txt.textAlign="center",e.txt.textColor=16777215,e.txt.size=24,e.txt.y=60,e.addChild(e.txt),e}return __extends(e,t),e.prototype.showScore=function(t){var e="您的成绩是:\n"+t+"\n再来一次吧";this.txt.text=e},e}(egret.Sprite);t.ScorePanel=e,__reflect(e.prototype,"fighter.ScorePanel")}(fighter||(fighter={}));var fighter;!function(t){function e(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e}var i=function(){function t(){}return t.hitTest=function(t,e){var i=t.getBounds(),r=e.getBounds();return i.x=t.x,i.y=t.y,r.x=e.x,r.y=e.y,i.intersects(r)},t}();t.GameUtil=i,__reflect(i.prototype,"fighter.GameUtil"),t.createBitmapByName=e}(fighter||(fighter={}));